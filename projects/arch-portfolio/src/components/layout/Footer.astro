---
import { resolveLink } from "../../lib/navigation";

interface FooterColumn {
    title: string;
    links: { label: string; link: string }[];
}

interface SocialLinks {
    facebook?: string;
    twitter?: string;
    instagram?: string;
    linkedin?: string;
    youtube?: string;
    whatsapp?: string;
}

interface Props {
    siteName?: string;
    logo?: string;
    columns?: FooterColumn[];
    showSocial?: boolean;
    socialLinks?: SocialLinks;
    copyrightText?: string;
    showBackToTop?: boolean;
}

const {
    siteName = "مكتب معماري",
    logo,
    columns = [],
    showSocial = true,
    socialLinks = {},
    copyrightText = "© {year} جميع الحقوق محفوظة",
    showBackToTop = true,
} = Astro.props;

const currentYear = new Date().getFullYear();
const formattedCopyright = copyrightText.replace(
    "{year}",
    currentYear.toString(),
);
---

<footer class="footer">
    <div class="container">
        <!-- Main Footer -->
        <div class="footer-main">
            <!-- Brand Column -->
            <div class="footer-brand">
                <a href="/" class="footer-logo">
                    {
                        logo ? (
                            <img
                                src={logo}
                                alt={siteName}
                                class="footer-logo-image"
                            />
                        ) : (
                            <span class="footer-logo-text">{siteName}</span>
                        )
                    }
                </a>

                {
                    showSocial && Object.values(socialLinks).some(Boolean) && (
                        <div class="social-links">
                            {socialLinks.facebook && (
                                <a
                                    href={socialLinks.facebook}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="social-link"
                                    aria-label="Facebook"
                                >
                                    <svg
                                        width="20"
                                        height="20"
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z" />
                                    </svg>
                                </a>
                            )}
                            {socialLinks.twitter && (
                                <a
                                    href={socialLinks.twitter}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="social-link"
                                    aria-label="Twitter"
                                >
                                    <svg
                                        width="20"
                                        height="20"
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                                    </svg>
                                </a>
                            )}
                            {socialLinks.instagram && (
                                <a
                                    href={socialLinks.instagram}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="social-link"
                                    aria-label="Instagram"
                                >
                                    <svg
                                        width="20"
                                        height="20"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <rect
                                            x="2"
                                            y="2"
                                            width="20"
                                            height="20"
                                            rx="5"
                                            ry="5"
                                        />
                                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" />
                                        <line
                                            x1="17.5"
                                            y1="6.5"
                                            x2="17.51"
                                            y2="6.5"
                                        />
                                    </svg>
                                </a>
                            )}
                            {socialLinks.linkedin && (
                                <a
                                    href={socialLinks.linkedin}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="social-link"
                                    aria-label="LinkedIn"
                                >
                                    <svg
                                        width="20"
                                        height="20"
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
                                        <rect
                                            x="2"
                                            y="9"
                                            width="4"
                                            height="12"
                                        />
                                        <circle cx="4" cy="4" r="2" />
                                    </svg>
                                </a>
                            )}
                            {socialLinks.youtube && (
                                <a
                                    href={socialLinks.youtube}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="social-link"
                                    aria-label="YouTube"
                                >
                                    <svg
                                        width="20"
                                        height="20"
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z" />
                                        <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02" />
                                    </svg>
                                </a>
                            )}
                            {socialLinks.whatsapp && (
                                <a
                                    href={`https://wa.me/${socialLinks.whatsapp.replace(/\D/g, "")}`}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="social-link"
                                    aria-label="WhatsApp"
                                >
                                    <svg
                                        width="20"
                                        height="20"
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                                    </svg>
                                </a>
                            )}
                        </div>
                    )
                }
            </div>

            <!-- Link Columns -->
            {
                columns.map((column) => (
                    <div class="footer-column">
                        <h4 class="footer-column-title">{column.title}</h4>
                        <ul class="footer-links">
                            {column.links.map((link) => (
                                <li>
                                    <a
                                        href={resolveLink(link.link)}
                                        class="footer-link"
                                    >
                                        {link.label}
                                    </a>
                                </li>
                            ))}
                        </ul>
                    </div>
                ))
            }
        </div>

        <!-- Bottom Bar -->
        <div class="footer-bottom">
            <p class="copyright">{formattedCopyright}</p>
        </div>
    </div>

    <!-- Back to Top -->
    {
        showBackToTop && (
            <button
                class="back-to-top"
                id="back-to-top"
                aria-label="العودة للأعلى"
            >
                <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <polyline points="18 15 12 9 6 15" />
                </svg>
            </button>
        )
    }
</footer>

<style>
    .footer {
        background: var(--color-surface);
        padding-top: 4rem;
        margin-top: auto;
    }

    .footer-main {
        display: grid;
        grid-template-columns: 2fr repeat(auto-fit, minmax(150px, 1fr));
        gap: 3rem;
        padding-bottom: 3rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .footer-brand {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .footer-logo {
        display: inline-flex;
        text-decoration: none;
    }

    .footer-logo-image {
        height: 48px;
        width: auto;
    }

    .footer-logo-text {
        font-family: var(--font-heading);
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--color-text);
    }

    .social-links {
        display: flex;
        gap: 0.75rem;
    }

    .social-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 44px;
        height: 44px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: var(--radius-base);
        color: var(--color-text-muted);
        transition: all 0.3s ease;
    }

    .social-link:hover {
        background: var(--color-accent);
        color: white;
        transform: translateY(-3px);
    }

    .footer-column {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .footer-column-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--color-text);
        margin-bottom: 0.5rem;
    }

    .footer-links {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .footer-link {
        font-size: 0.95rem;
        color: var(--color-text-muted);
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .footer-link:hover {
        color: var(--color-accent);
    }

    .footer-bottom {
        padding: 1.5rem 0;
        text-align: center;
    }

    .copyright {
        font-size: 0.9rem;
        color: var(--color-text-muted);
    }

    .back-to-top {
        position: fixed;
        bottom: 2rem;
        left: 2rem;
        width: 50px;
        height: 50px;
        background: var(--color-accent);
        border: none;
        border-radius: var(--radius-base);
        color: white;
        cursor: pointer;
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(233, 69, 96, 0.3);
        z-index: 999;
    }

    .back-to-top.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .back-to-top:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 30px rgba(233, 69, 96, 0.4);
    }

    @media (max-width: 768px) {
        .footer-main {
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .footer-brand {
            align-items: center;
            text-align: center;
        }

        .footer-column {
            text-align: center;
        }

        .footer-links {
            align-items: center;
        }

        .social-links {
            justify-content: center;
        }

        .back-to-top {
            bottom: 1rem;
            left: 1rem;
        }
    }
</style>

<script>
    const backToTop = document.getElementById("back-to-top");

    window.addEventListener("scroll", () => {
        if (window.scrollY > 500) {
            backToTop?.classList.add("visible");
        } else {
            backToTop?.classList.remove("visible");
        }
    });

    backToTop?.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
    });
</script>
