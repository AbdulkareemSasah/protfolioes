---
import Layout from "../layouts/Layout.astro";
import Header from "../components/layout/Header.astro";
import Footer from "../components/layout/Footer.astro";
import { getEntry } from "astro:content";

const headerData = await getEntry("settings", "header");
const footerData = await getEntry("settings", "footer");
const siteData = await getEntry("settings", "site");
const labels = await getEntry("settings", "labels");

// Text labels with fallbacks
const l = {
    contactUs: labels?.data.contactUs || "تواصل معنا",
    formNameLabel: labels?.data.formNameLabel || "الاسم الكامل",
    formEmailLabel: labels?.data.formEmailLabel || "البريد الإلكتروني",
    formPhoneLabel: labels?.data.formPhoneLabel || "رقم الهاتف",
    formMessageLabel: labels?.data.formMessageLabel || "الرسالة",
    submit: labels?.data.submit || "إرسال",
    formSuccessMessage: labels?.data.formSuccessMessage || "شكراً لتواصلك معنا! سنرد عليك قريباً.",
};
---

<Layout title={l.contactUs}>
    <Header 
        slot="header"
        siteName={siteData?.data.siteName}
        logo={siteData?.data.logo}
        logoPosition={headerData?.data.logoPosition}
        navigation={headerData?.data.navigation}
        showCta={headerData?.data.showCta}
        ctaText={headerData?.data.ctaText}
        ctaLink={headerData?.data.ctaLink}
        showThemeToggle={headerData?.data.showThemeToggle}
    />

    <div class="container page-content">
        <div class="contact-grid">
            <div class="contact-info">
                <h1 class="page-title">{l.contactUs}</h1>
                <p class="contact-desc">
                    نحن هنا لمساعدتك في تحقيق رؤيتك المعمارية. تواصل معنا لمناقشة مشروعك القادم.
                </p>
                
                <div class="info-items">
                    <div class="info-item">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                        </div>
                        <div>
                            <h3>الهاتف</h3>
                            <p>+966 50 000 0000</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                        </div>
                        <div>
                            <h3>البريد الإلكتروني</h3>
                            <p>info@arch-portfolio.com</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                        </div>
                        <div>
                            <h3>العنوان</h3>
                            <p>الرياض، المملكة العربية السعودية</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="contact-form-wrapper">
                <form action="https://api.web3forms.com/submit" method="POST" id="contact-form" class="contact-form">
                    <!-- Replace with your Access Key -->
                    <input type="hidden" name="access_key" value="YOUR_ACCESS_KEY_HERE">
                    <input type="checkbox" name="botcheck" class="hidden" style="display: none;">

                    <div class="form-group">
                        <label for="name">{l.formNameLabel}</label>
                        <input type="text" name="name" id="name" required placeholder={l.formNameLabel} />
                    </div>

                    <div class="form-group">
                        <label for="email">{l.formEmailLabel}</label>
                        <input type="email" name="email" id="email" required placeholder={l.formEmailLabel} />
                    </div>

                    <div class="form-group">
                        <label for="phone">{l.formPhoneLabel}</label>
                        <input type="tel" name="phone" id="phone" placeholder={l.formPhoneLabel} />
                    </div>

                    <div class="form-group">
                        <label for="message">{l.formMessageLabel}</label>
                        <textarea name="message" id="message" rows="5" required placeholder={l.formMessageLabel}></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary submit-btn">
                        {l.submit}
                    </button>

                    <div id="form-result" class="form-result"></div>
                </form>
            </div>
        </div>
    </div>

    <Footer 
        slot="footer"
        siteName={siteData?.data.siteName}
        logo={siteData?.data.logo}
        columns={footerData?.data.columns}
        showSocial={footerData?.data.showSocial}
        socialLinks={footerData?.data.socialLinks}
        copyrightText={footerData?.data.copyrightText}
        showBackToTop={footerData?.data.showBackToTop}
    />
</Layout>

<style>
    .page-content {
        padding-top: 120px;
        padding-bottom: 4rem;
    }

    .contact-grid {
        display: grid;
        grid-template-columns: 1fr 1.5fr;
        gap: 4rem;
        align-items: start;
    }

    @media (max-width: 900px) {
        .contact-grid {
            grid-template-columns: 1fr;
            gap: 2rem;
        }
    }

    .page-title {
        font-family: var(--font-heading);
        font-size: 3rem;
        color: var(--color-text);
        margin-bottom: 1rem;
    }

    .contact-desc {
        color: var(--color-text-muted);
        font-size: 1.1rem;
        margin-bottom: 3rem;
        line-height: 1.6;
    }

    .info-items {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .info-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
    }

    .icon {
        width: 48px;
        height: 48px;
        background: rgba(var(--color-accent-rgb, 233, 69, 96), 0.1);
        color: var(--color-accent);
        border-radius: var(--radius-base);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .info-item h3 {
        font-size: 1.1rem;
        margin-bottom: 0.25rem;
        color: var(--color-text);
    }

    .info-item p {
        color: var(--color-text-muted);
    }

    .contact-form-wrapper {
        background: var(--color-surface);
        padding: 2.5rem;
        border-radius: var(--radius-lg);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .contact-form {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .form-group label {
        font-weight: 500;
        color: var(--color-text);
    }

    .form-group input,
    .form-group textarea {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-base);
        padding: 0.75rem 1rem;
        color: var(--color-text);
        font-family: inherit;
        transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: var(--color-accent);
        background: rgba(255, 255, 255, 0.05);
    }

    .submit-btn {
        margin-top: 1rem;
        cursor: pointer;
    }

    .form-result {
        margin-top: 1rem;
        padding: 1rem;
        border-radius: var(--radius-base);
        display: none;
    }
    
    .form-result.success {
        display: block;
        background: rgba(46, 204, 113, 0.1);
        color: #2ecc71;
        border: 1px solid rgba(46, 204, 113, 0.2);
    }
    
    .form-result.error {
        display: block;
        background: rgba(231, 76, 60, 0.1);
        color: #e74c3c;
        border: 1px solid rgba(231, 76, 60, 0.2);
    }
</style>

<script is:inline define:vars={{ successMessage: l.formSuccessMessage }}>
    const form = document.getElementById('contact-form');
    const result = document.getElementById('form-result');

    form?.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(form);
        const object = Object.fromEntries(formData);
        const json = JSON.stringify(object);

        result.innerHTML = "جاري الإرسال...";
        result.classList.remove('success', 'error');
        result.style.display = 'block';

        fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: json
        })
        .then(async (response) => {
            let json = await response.json();
            if (response.status == 200) {
                result.innerHTML = successMessage;
                result.classList.add('success');
            } else {
                console.log(response);
                result.innerHTML = json.message;
                result.classList.add('error');
            }
        })
        .catch(error => {
            console.log(error);
            result.innerHTML = "حدث خطأ ما!";
            result.classList.add('error');
        })
        .then(function() {
            form.reset();
            setTimeout(() => {
                result.style.display = "none";
            }, 5000);
        });
    });
</script>
